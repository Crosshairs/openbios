<rules>

<pre><![CDATA[
#
# Autogenerated OpenBIOS Makefile
# (C) 2004-2005 by the OpenBIOS team
#

ARCH := amd64
ODIR := obj-$(ARCH)
HOSTCC := gcc
HOSTCFLAGS := -O -g -fprofile-arcs -ftest-coverage -Wall -W -DFCOMPILER -DBOOTSTRAP $(CROSSCFLAGS)
HOSTINCLUDES := -Iinclude -Ikernel/include -I$(ODIR)/target/include

CC := gcc 
AR := ar
NM := nm
STRIP := strip
RANLIB := ranlib
INSTALL := install

CFLAGS := -Os -Wall -W -DNATIVE_BITWIDTH_EQUALS_HOST_BITWIDTH -USWAP_ENDIANNESS -fno-builtin-bcopy -fno-builtin-log2
INCLUDES := -Iinclude -Ikernel/include -I$(ODIR)/target/include

#
# pre rules
#

all: versions dictionaries host-libraries target-libraries host-executables target-executables

VERSION := "1.0RC1"

versions: $(ODIR)/forth/version.fs

$(ODIR)/forth/version.fs:
	@test -d $(dir $@) || $(INSTALL) -d $(dir $@)
	@DATE="$(shell echo `LC_ALL=C TZ=UTC date +'%b %e %Y %H:%M'`)" ;  \
		( echo ": builddate \" $$DATE\" ; " ;     \
		  echo ": version \" $(VERSION)\" ; " ; ) \
		  > $(dir $@)/version.fs

]]></pre>

 <!-- host compiler build rules -->

<rule target="host" entity="executable">
	$(HOSTCC) $(HOSTCFLAGS) -o $@ $^
</rule>

<rule target="host" entity="object">
	$(HOSTCC) $(HOSTCFLAGS) $(HOSTINCLUDES) -c -o $@ $^
</rule>
 
<rule target="host" entity="library">
	$(AR) cru $@ $^; $(RANLIB) $@
</rule>
 
 <!-- target/cross compiler build rules -->
 
<rule target="target" entity="executable">
	$(CC) $(CFLAGS) -o $@ $^
</rule>

<rule target="target" entity="object">
	$(CC) $$EXTRACFLAGS $(CFLAGS) $(INCLUDES) -c -o $@ $^
</rule>
  
<rule target="target" entity="library">
	$(AR) cru $@ $^; $(RANLIB) $@
</rule>

</rules>
